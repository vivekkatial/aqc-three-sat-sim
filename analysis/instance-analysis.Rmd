---
title: "Instance Analysis"
author: "Vivek Katial"
date: "01/06/2020"
output: 
  html_document:
    toc: true
  pdf_document:
    toc: true
editor_options: 
  chunk_output_type: console
---

## Introduction

This analysis looks into a building a model to for understanding $\mathbb{P}(\text{success})$.

We first need to get the data from `mlflow`. This analysis goes into detail on the steps required to go from loading the data to building various models. We also conduct an EDA on the instance features.

## Set up Environment

- Below is the code to load all the packages and files to set up the environment.
- We also load the "enriched" data into our environment.

```{r setup, warning=FALSE, message=FALSE, error=FALSE}
# Import libraries
library(here)
library(tidyverse)

# Set knitr options
knitr::opts_chunk$set(echo = TRUE, warning = F, message = F, error = F, fig.align = 'center', fig.width = 10)

# Source in relavent scripts
source(here("src/instance-generation/generate-relaxed-usa-instances.R"))
source(here("src/instance-generation/generate-usa-instances.R"))
```


## Setup Instance Generation
```{r}
d_instance_set <- read_rds("data/d_instance_set.rds")

d_instance_set %>% 
  gather(type, clause, c(-n_qubits, -params, -n_sat, -instance_index)) %>% 
  mutate(
    n_vars = n_qubits,
    n_cls = map_dbl(clause, length),
    clause_var_ratio = n_cls/n_vars
    ) %>% 
  ggplot(aes(x = clause_var_ratio)) +
  geom_histogram(col = "white") + 
  facet_wrap(~type) +
  theme_light() +
  labs(
    x = "Clause / Variable Ratio"
  )

```




```{r}

d_time <- map(5:20, function(x){
  t = system.time(list(n_qubits = x, n_sat = 3) %>% generate_clauses())
  t[[3]]
}) %>% 
  tibble(value = .) %>% 
  mutate(
    value = as.numeric(value),
    n = 1:n() + 4
  )

```